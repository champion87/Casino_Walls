<!DOCTYPE html>
<html>

<head>
    <title> BLACK JACK </title>
</head>

<body onload="setup()">
    <p>Wanna draw another card?</p>
    <button onclick="choose('yes')">YES</button>
    <button onclick="choose('no')">NO</button>

    <p id="score"></p>
    <p>Your Hand:</p>
    <p id="hand"></p>
    <strong id="game_over_text1">GAME OVER!</strong>
    <p id="game_over_text2">Press the button to play again</p>
    <button id="reply_button" onclick="play_again();">Play Again</button>
    <button id="lobby_button" onclick="back_to_lobby();">GO Back To Lobby1</button>
</body>

</html>

<script>

    var my_cards = ["test"]
    var is_game_over = true
    var score = 0

    async function setup() {
        hide_game_over()

        // /games/black_jack/

        response = await fetch("/games/black_jack/first_turn");
        json = await response.json();

        console.log(json)

        update_hand(json.hand)
        update_score(json.sum)
        is_game_over = json.finish_state
    }

    function update_hand(new_hand) {
        document.getElementById("hand").innerHTML = new_hand.toString();
    }

    function update_score(new_score)
    {
        score = new_score
        document.getElementById("score").innerHTML = "Score: " + score  
    }

    function choose(choice) {
        if (is_game_over) { return; }

        console.log('Hello World', choice);
        if (choice == 'yes') {
            draw_card();
        }
        else {
            fold();
        }
    }

    var IDs_of_game_over_elements = [
        "game_over_text1",
        "game_over_text2",
        "reply_button",
        "lobby_button"
    ]

    function hide_game_over() {
        game_over("none")
    }

    function game_over(visability = "inline") {
        IDs_of_game_over_elements.forEach(id => {document.getElementById(id).style.display = visability;})
    }

    async function fold() {
        response = await fetch("/games/black_jack/fold");
        json = await response.json();

        console.log(json)

        game_over()
    }

    // GETs and uploads the new card. Doesn't check game rules.
    async function draw_card() {
        response = await fetch("/games/black_jack/draw");
        json = await response.json();

        console.log(json)

        update_hand(json.hand)
        update_score(json.sum)

        if (json.finish_state) {
            game_over()
        }
    }

    async function play_again()
    {

    }

    async function back_to_lobby()
    {
        location.href = "/games/black_jack/lobby1"
    }

</script>